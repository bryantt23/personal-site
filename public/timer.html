<!doctype html>
<html ng-app="myApp">
<head>
  <script src="http://code.angularjs.org/angular-1.0.0rc11.min.js"></script>
  <!-- <script src="http://documentcloud.github.com/underscore/underscore-min.js"></script> -->
</head>
<body>
  <div ng-controller="AlbumCtrl">
    {{counter|formatTimer}}
    <button ng-click="takeAction()">{{buttonText}}</button>
  </div>

  <script>
  'use strict';
  var myApp = angular.module('myApp', []);
  myApp.controller('AlbumCtrl', function($scope,$timeout) {
    $scope.counter = 3;
    $scope.stopped = false;
    $scope.buttonText='Stop';
    $scope.onTimeout = function(){

      if($scope.counter===0){
        $timeout.cancel(mytimeout);
        $scope.counter = 3;
        $scope.buttonText='Resume';
        $scope.stopped=!$scope.stopped;
      }
      else{
        $scope.counter--;
        mytimeout = $timeout($scope.onTimeout,1000);

      }
    }
    var mytimeout = $timeout($scope.onTimeout,1000);
    $scope.takeAction = function(){
      if(!$scope.stopped){
        $timeout.cancel(mytimeout);
        $scope.buttonText='Resume';
      }
      else
      {
        mytimeout = $timeout($scope.onTimeout,1000);
        $scope.buttonText='Stop';
      }
      $scope.stopped=!$scope.stopped;
    }
  });

  myApp.filter('formatTimer', function() {
    return function(input)
    {
      function z(n) {return (n<10? '0' : '') + n;}
      var seconds = input % 60;
      var minutes = Math.floor(input / 60);
      var hours = Math.floor(minutes / 60);
      return (z(hours) +':'+z(minutes)+':'+z(seconds));
    };
  });





  </script>

</body>
</html>
